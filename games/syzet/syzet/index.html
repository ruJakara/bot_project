<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–ï–°–ù–û–ï –¶–ê–†–°–¢–í–û ‚Ä¢ –í–ï–¢–í–ò –°–£–î–¨–ë–´</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Palatino', 'Georgia', serif;
            user-select: none;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: #1a2f1f;
            background-image: radial-gradient(circle at 10% 20%, #2d5a3a, #0e2b14);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }

        .game-container {
            max-width: 1000px;
            width: 100%;
            background: #263f2b;
            border-radius: 48px 48px 24px 24px;
            border: 4px solid #b89b7b;
            box-shadow: 0 20px 40px rgba(0,0,0,0.7), inset 0 0 30px #5b8c5a;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            backdrop-filter: blur(2px);
        }

        /* –®–∞–ø–∫–∞ —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ */
        .resources-bar {
            background: #2b412b;
            border-radius: 100px;
            padding: 20px 30px;
            border: 2px solid #c5a86a;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
            box-shadow: inset 0 0 20px #1a2e1a, 0 5px 0 #4a6b3f;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.6rem;
            color: #f9e7b3;
            text-shadow: 2px 2px 0 #3f2b0f;
        }

        .resource-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 6px gold);
        }

        .resource-value {
            background: #1d2b1d;
            padding: 8px 20px;
            border-radius: 40px;
            border: 2px solid #b69258;
            font-weight: bold;
            min-width: 90px;
            text-align: center;
            color: #ffecb3;
            box-shadow: inset 0 2px 5px #00000060;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: –¥–µ—Ä–µ–≤–æ —Å–ª–µ–≤–∞, —Ç–µ–∫—Å—Ç —Å–ø—Ä–∞–≤–∞ */
        .play-area {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 20px;
        }

        /* –î–ï–†–ï–í–û (–í–ï–¢–ö–ò) */
        .tree-panel {
            flex: 1.2;
            min-width: 280px;
            background: #213321;
            border-radius: 40px;
            border: 3px solid #8f7a54;
            padding: 20px;
            box-shadow: inset 0 0 30px #101e10, 0 10px 0 #4f6b41;
        }

        .tree-title {
            font-size: 2rem;
            color: #d4c095;
            text-align: center;
            border-bottom: 2px dashed #9e8b5f;
            padding-bottom: 8px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 10px #c9aa6b;
        }

        .branch-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .branch-card {
            background: #2f462f;
            border-radius: 30px;
            border: 2px solid;
            padding: 16px;
            transition: 0.1s;
            cursor: pointer;
            box-shadow: 0 6px 0 #1d2e1d;
        }

        .branch-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 9px 0 #1d2e1d;
            filter: brightness(1.2);
        }

        .branch-card:active {
            transform: translateY(5px);
            box-shadow: 0 2px 0 #1d2e1d;
        }

        .branch-0 {
            border-color: #cdb27b;
        }

        .branch-1 {
            border-color: #a1c181;
        }

        .branch-2 {
            border-color: #c9a9cf;
        }

        .branch-name {
            font-size: 1.7rem;
            font-weight: bold;
            color: #efe6c6;
            text-shadow: 0 2px 0 #5b4c31;
            display: flex;
            justify-content: space-between;
        }

        .branch-desc {
            color: #b9cfb0;
            margin: 10px 0 6px;
            font-style: italic;
        }

        .branch-cost {
            background: #1b2a1b;
            display: inline-block;
            padding: 6px 14px;
            border-radius: 50px;
            border: 1px solid #ebc87e;
            color: #ffdf99;
            font-weight: bold;
        }

        /* –ü–∞–Ω–µ–ª—å —Å—é–∂–µ—Ç–∞ */
        .story-panel {
            flex: 2;
            min-width: 350px;
            background: #1d2d1d;
            border-radius: 48px;
            border: 3px solid #b49462;
            padding: 24px;
            box-shadow: inset 0 0 30px #102010, 0 10px 0 #4f6638;
            display: flex;
            flex-direction: column;
        }

        .story-header {
            display: flex;
            justify-content: space-between;
            color: #c9b386;
            font-size: 1.3rem;
            border-bottom: 1px solid #7e9f6e;
            padding-bottom: 12px;
            margin-bottom: 20px;
        }

        .story-text {
            background: #1f301f;
            border-radius: 32px;
            padding: 24px;
            font-size: 1.5rem;
            line-height: 1.4;
            color: #e9ddc3;
            border: 2px solid #8f6f42;
            box-shadow: inset 0 0 30px #0f1f0f;
            min-height: 200px;
            flex: 1;
            margin-bottom: 20px;
            overflow-y: auto;
            max-height: 300px;
        }

        .choices-area {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 10px;
        }

        .choice-btn {
            background: #374d37;
            border: 3px solid #b99f63;
            color: #ffefcf;
            font-size: 1.3rem;
            padding: 18px 20px;
            border-radius: 60px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.1s;
            text-align: left;
            box-shadow: 0 5px 0 #354f2a;
        }

        .choice-btn:hover {
            background: #4f6f4f;
            transform: translateY(-3px);
            box-shadow: 0 8px 0 #354f2a;
        }

        .choice-btn:active {
            transform: translateY(5px);
            box-shadow: 0 2px 0 #354f2a;
        }

        .choice-btn.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.7);
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .settings-bar {
            background: #2e462e;
            border-radius: 40px;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            border: 2px solid #ad8f5b;
            box-shadow: inset 0 0 20px #1c2f1c;
        }

        .volume-controls {
            display: flex;
            gap: 40px;
        }

        .vol-item {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #e9daad;
        }

        input[type=range] {
            width: 140px;
            height: 8px;
            background: #4a5e3f;
            border-radius: 10px;
            -webkit-appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #eec67e;
            border-radius: 50%;
            box-shadow: 0 0 15px #ffbf69;
            cursor: pointer;
            border: 2px solid #6b4f26;
        }

        .music-btn {
            background: #3d583d;
            border: 2px solid #f0cf91;
            color: white;
            border-radius: 60px;
            padding: 10px 24px;
            font-weight: bold;
            cursor: pointer;
        }

        .music-btn:hover {
            background: #5f825f;
        }

        footer {
            color: #af9f7b;
            text-align: center;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
<div class="game-container" id="gameContainer">
    <!-- –†–µ—Å—É—Ä—Å—ã -->
    <div class="resources-bar">
        <div class="resource"><span class="resource-icon">üë•</span> <span class="resource-value" id="peopleVal">10</span></div>
        <div class="resource"><span class="resource-icon">ü™ô</span> <span class="resource-value" id="goldVal">15</span></div>
        <div class="resource"><span class="resource-icon">üîÆ</span> <span class="resource-value" id="manaVal">5</span></div>
        <div class="resource"><span class="resource-icon">‚öîÔ∏è</span> <span class="resource-value" id="powerVal">8</span></div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –∑–æ–Ω–∞ -->
    <div class="play-area">
        <!-- –î–ï–†–ï–í–û –†–ï–®–ï–ù–ò–ô (—Ç—Ä–∏ –≤–µ—Ç–∫–∏) -->
        <div class="tree-panel">
            <div class="tree-title">üå≥ –í–ï–¢–í–ò –°–£–î–¨–ë–´</div>
            <div class="branch-container">
                <!-- –í–µ—Ç–∫–∞ 1: –õ–µ—Å–Ω–æ–π –¥—É—Ö -->
                <div class="branch-card branch-0" id="branchNature">
                    <div class="branch-name">üçÉ –î—É—Ö –ª–µ—Å–∞ <span id="natureLvl">0</span></div>
                    <div class="branch-desc">–ü—Ä–∏–∑—ã–≤–∞–µ—Ç —Å–æ—é–∑–Ω–∏–∫–æ–≤, –¥–∞—ë—Ç –º–∞–Ω—É</div>
                    <div class="branch-cost" id="natureCost">üîÆ 8 –º–∞–Ω—ã</div>
                </div>
                <!-- –í–µ—Ç–∫–∞ 2: –¢–æ—Ä–≥–æ–≤—ã–π –ø—É—Ç—å -->
                <div class="branch-card branch-1" id="branchTrade">
                    <div class="branch-name">üè™ –¢–æ—Ä–≥–æ–≤–ª—è <span id="tradeLvl">0</span></div>
                    <div class="branch-desc">–ó–æ–ª–æ—Ç–æ –∏ –ª—é–¥–∏, –Ω–æ —Ä–∏—Å–∫</div>
                    <div class="branch-cost" id="tradeCost">ü™ô 12 –∑–æ–ª–æ—Ç–∞</div>
                </div>
                <!-- –í–µ—Ç–∫–∞ 3: –í–æ–µ–Ω–Ω–∞—è —Ç—Ä–æ–ø–∞ -->
                <div class="branch-card branch-2" id="branchWar">
                    <div class="branch-name">‚öîÔ∏è –î—Ä—É–∂–∏–Ω–∞ <span id="warLvl">0</span></div>
                    <div class="branch-desc">–°–∏–ª–∞ –∏ –∑–∞—â–∏—Ç–∞, –Ω–æ —Ç—Ä–∞—Ç–∏—Ç –ª—é–¥–µ–π</div>
                    <div class="branch-cost" id="warCost">üë• 5 –ª—é–¥–µ–π, ‚öîÔ∏è 5 —Å–∏–ª—ã</div>
                </div>
            </div>
            <div style="color:#b9a577; text-align:center; margin-top:16px;">‚¨ÜÔ∏è –ø—Ä–æ–∫–∞—á–∫–∞ –≤–µ—Ç–æ–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä—ã</div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: —Å—é–∂–µ—Ç –∏ –≤—ã–±–æ—Ä—ã -->
        <div class="story-panel">
            <div class="story-header">
                <span>üìñ –õ–µ—Ç–æ–ø–∏—Å—å</span>
                <span id="dayCounter">–î–µ–Ω—å 1</span>
            </div>
            <div class="story-text" id="storyDisplay">
                –¢—ã –≤–æ–∂–¥—å –ø–ª–µ–º–µ–Ω–∏ –≤ —á–∞—â–µ –ª–µ—Å–∞. –°—É–¥—å–±–∞ –ø–ª–µ–º–µ–Ω–∏ –≤ —Ç–≤–æ–∏—Ö —Ä—É–∫–∞—Ö...
            </div>
            <div class="choices-area" id="choicesContainer">
                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ -->
                <div class="choice-btn" data-choice="0">üí¨ –û—Å–º–æ—Ç—Ä–µ—Ç—å –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏</div>
                <div class="choice-btn" data-choice="1">üí¨ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å–æ —Å—Ç–∞—Ä–µ–π—à–∏–Ω–æ–π</div>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –º—É–∑—ã–∫–∞, –∑–≤—É–∫ -->
    <div class="settings-bar">
        <div class="volume-controls">
            <div class="vol-item">üéµ –ú—É–∑—ã–∫–∞ <input type="range" id="musicVol" min="0" max="1" step="0.01" value="0.3"></div>
            <div class="vol-item">üîä –ó–≤—É–∫–∏ <input type="range" id="soundVol" min="0" max="1" step="0.01" value="0.5"></div>
        </div>
        <div class="music-btn" id="playMusicBtn">‚ñ∂ –ò–≥—Ä–∞—Ç—å –º—É–∑—ã–∫—É –ª–µ—Å–∞</div>
    </div>
    <footer>üçÇ –ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç –ø–ª–µ–º—è ‚Ä¢ –ù–∞–π–¥–∏ –≤—Å–µ –∫–æ–Ω—Ü–æ–≤–∫–∏ üçÇ</footer>
</div>

<script>
    (function() {
        // ---------- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã ----------
        let resources = {
            people: 10,
            gold: 15,
            mana: 5,
            power: 8
        };

        // –£—Ä–æ–≤–Ω–∏ –≤–µ—Ç–æ–∫ (–≤–ª–∏—è—é—Ç –Ω–∞ —Å—é–∂–µ—Ç)
        let natureLevel = 0;
        let tradeLevel = 0;
        let warLevel = 0;

        let day = 1;
        let gameOver = false;
        let endingReached = false;

        // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ —Å—é–∂–µ—Ç–Ω–æ–º –¥–µ—Ä–µ–≤–µ
        let currentNode = 'start';

        // ---------- –°–Æ–ñ–ï–¢–ù–û–ï –î–ï–†–ï–í–û (–Ω–µ –∫–ª–∏–∫–µ—Ä, –∞ –Ω–∞—Å—Ç–æ—è—â–∏–µ –≤—ã–±–æ—Ä—ã) ----------
        const storyTree = {
            start: {
                text: 'üåø –¢—ã –ø—Ä–æ—Å—ã–ø–∞–µ—à—å—Å—è –≤ —Å–≤–æ–µ–º —à–∞–ª–∞—à–µ. –ü–ª–µ–º—è –∂–¥–µ—Ç —Ç–≤–æ–µ–≥–æ —Å–ª–æ–≤–∞. –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—à—å –Ω–∞—Ä–æ–¥?',
                choices: [
                    { text: 'üå≥ –£–≥–ª—É–±–∏—Ç—å—Å—è –≤ –ª–µ—Å, –∫ –î—É–±—É –¥—É—Ö–æ–≤', nextNode: 'forest', req: null },
                    { text: 'üèûÔ∏è –í—ã–π—Ç–∏ –∫ —Ä–µ–∫–µ, –Ω–∞—Ç–æ—Ä–≥–æ–≤–∞—Ç—å —Å —Ä—ã–±–∞–∫–∞–º–∏', nextNode: 'river', req: null },
                    { text: 'üõ°Ô∏è –°–æ–±—Ä–∞—Ç—å —Å–æ–≤–µ—Ç —Å—Ç–∞—Ä–µ–π—à–∏–Ω –¥–ª—è –≤–æ–π–Ω—ã —Å —Å–æ—Å–µ–¥—è–º–∏', nextNode: 'warCouncil', req: null }
                ]
            },
            forest: {
                text: '–¢—ã –≤—Ö–æ–¥–∏—à—å –ø–æ–¥ —Å–≤–æ–¥—ã –¥—Ä–µ–≤–Ω–µ–≥–æ –ª–µ—Å–∞. –ó–¥–µ—Å—å –æ–±–∏—Ç–∞–µ—Ç –¥—É—Ö. –û–Ω –≥–æ–≤–æ—Ä–∏—Ç: "–ü—Ä–∏–Ω–µ—Å–∏ –º–Ω–µ –º–∞–Ω—É, –∏ —è –ø–æ–º–æ–≥—É".',
                choices: [
                    { text: '‚ú® –û—Ç–¥–∞—Ç—å 5 –º–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)', nextNode: 'spiritHelp', req: { mana: 5 } },
                    { text: 'üëã –ü–æ–∫–ª–æ–Ω–∏—Ç—å—Å—è –∏ —É–π—Ç–∏ –Ω–∏ —Å —á–µ–º', nextNode: 'start', req: null }
                ]
            },
            spiritHelp: {
                text: '–î—É—Ö –¥–æ–≤–æ–ª—å–Ω–æ —à–µ–ª–µ—Å—Ç–∏—Ç –ª–∏—Å—Ç–≤–æ–π. –¢–≤–æ—è –º–∞–≥–∏—è –ª–µ—Å–∞ —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è! +2 –º–∞–Ω—ã, +1 —Å–∏–ª–∞ (–±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ)',
                choices: [
                    { text: 'üå≤ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ª–∞–≥–µ—Ä—å', nextNode: 'start', req: null }
                ],
                effect: () => {
                    resources.mana += 2;
                    resources.power += 1;
                    natureLevel++; // –≤–µ—Ç–∫–∞ –ø—Ä–æ–∫–∞—á–∞–ª–∞—Å—å
                }
            },
            river: {
                text: '–£ —Ä–µ–∫–∏ —à—É–º–Ω—ã–π —Ä—ã–Ω–æ–∫. –¢–æ—Ä–≥–æ–≤—Ü—ã –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç –æ–±–º–µ–Ω. –ß—Ç–æ –±—É–¥–µ—à—å –¥–µ–ª–∞—Ç—å?',
                choices: [
                    { text: 'üí∞ –ö—É–ø–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (5 –∑–æ–ª–æ—Ç–∞ ‚Üí +3 —Å–∏–ª—ã)', nextNode: 'tradeBuy', req: { gold: 5 } },
                    { text: 'üë• –ù–∞–Ω—è—Ç—å —Ä–∞–±–æ—á–∏—Ö (3 –∑–æ–ª–æ—Ç–∞ ‚Üí +2 –ª—é–¥–µ–π)', nextNode: 'tradeHire', req: { gold: 3 } }
                ]
            },
            tradeBuy: {
                text: '–ö—É–∑–Ω–µ—Ü –¥–∞–ª –¥–æ–±—Ä–æ—Ç–Ω—ã–µ —Ç–æ–ø–æ—Ä—ã. –°–∏–ª–∞ –ø–ª–µ–º–µ–Ω–∏ –≤—ã—Ä–æ—Å–ª–∞.',
                choices: [ { text: '‚õµ –í–µ—Ä–Ω—É—Ç—å—Å—è', nextNode: 'start', req: null } ],
                effect: () => { resources.gold -= 5; resources.power += 3; tradeLevel++; }
            },
            tradeHire: {
                text: '–î–≤–∞ —Ä—ã–±–∞–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –ø–ª–µ–º–µ–Ω–∏. –õ—é–¥–µ–π —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ.',
                choices: [ { text: 'üêü –û–±—Ä–∞—Ç–Ω–æ –≤ –ª–∞–≥–µ—Ä—å', nextNode: 'start', req: null } ],
                effect: () => { resources.gold -= 3; resources.people += 2; tradeLevel++; }
            },
            warCouncil: {
                text: '–°—Ç–∞—Ä–µ–π—à–∏–Ω—ã –º—Ä–∞—á–Ω—ã. "–í–æ–∂–¥—å, –Ω–∞ –Ω–∞—Å –º–æ–≥—É—Ç –Ω–∞–ø–∞—Å—Ç—å. –ù—É–∂–Ω–∞ –¥—Ä—É–∂–∏–Ω–∞". –¢—Ä–∞—Ç—å —Å–∏–ª—É, —á—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è.',
                choices: [
                    { text: 'üõ°Ô∏è –°–æ–∑–≤–∞—Ç—å —Å—Ç—Ä–∞–∂—É (3 —Å–∏–ª—ã, 2 –ª—é–¥–µ–π) ‚Äî –∑–∞—â–∏—Ç–∞ +5', nextNode: 'warDefend', req: { power: 3, people: 2 } },
                    { text: 'ü§ù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ—Å–ª–æ–≤ —Å –¥–∞–Ω—å—é (5 –∑–æ–ª–æ—Ç–∞)', nextNode: 'warPay', req: { gold: 5 } }
                ]
            },
            warDefend: {
                text: '–í–æ–∏–Ω—ã —Ç—Ä–µ–Ω–∏—Ä—É—é—Ç—Å—è. –¢–µ–ø–µ—Ä—å –ø–ª–µ–º—è –∫—Ä–µ–ø—á–µ. (–°–∏–ª–∞ +2, –ª—é–¥–∏ -2)',
                choices: [ { text: '‚öîÔ∏è –í –ª–∞–≥–µ—Ä—å', nextNode: 'start', req: null } ],
                effect: () => { resources.power -= 3; resources.people -= 2; resources.power += 5; warLevel++; }
            },
            warPay: {
                text: '–ü–æ—Å–ª—ã –æ—Ç–≤–µ–ª–∏ —É–≥—Ä–æ–∑—É. –ú–∏—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω —Ü–µ–Ω–æ–π –∑–æ–ª–æ—Ç–∞.',
                choices: [ { text: 'üïäÔ∏è –î–æ–º–æ–π', nextNode: 'start', req: null } ],
                effect: () => { resources.gold -= 5; warLevel++; }
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function refreshUI() {
            document.getElementById('peopleVal').innerText = resources.people;
            document.getElementById('goldVal').innerText = resources.gold;
            document.getElementById('manaVal').innerText = resources.mana;
            document.getElementById('powerVal').innerText = resources.power;
            document.getElementById('dayCounter').innerText = `–î–µ–Ω—å ${day}`;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ç–æ–∫
            document.getElementById('natureLvl').innerText = natureLevel;
            document.getElementById('tradeLvl').innerText = tradeLevel;
            document.getElementById('warLvl').innerText = warLevel;

            // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–Ω—ã (–¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã)
            document.getElementById('natureCost').innerHTML = natureLevel < 3 ? 'üîÆ 8 –º–∞–Ω—ã' : 'üëë –≤—ã—Å—à–∏–π –¥—É—Ö';
            document.getElementById('tradeCost').innerHTML = tradeLevel < 3 ? 'ü™ô 12 –∑–æ–ª–æ—Ç–∞' : 'üí∞ –∫—É–ø–µ—Ü';
            document.getElementById('warCost').innerHTML = warLevel < 3 ? 'üë• 5 + ‚öîÔ∏è 5' : '‚öîÔ∏è –≤–æ–∂–¥—å';

            // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ game over
            if (resources.people <= 0) {
                storyDisplay('–¢–≤–æ—ë –ø–ª–µ–º—è –≤—ã–º–µ—Ä–ª–æ... –≠—Ç–æ –∫–æ–Ω–µ—Ü.');
                gameOver = true;
            }
            if (resources.people > 50) endingReached = true; // —Ö–æ—Ä–æ—à–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞
        }

        function storyDisplay(text) {
            document.getElementById('storyDisplay').innerText = text;
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —É–∑–µ–ª —Å—é–∂–µ—Ç–∞
        function loadNode(nodeId) {
            if (gameOver) return;
            const node = storyTree[nodeId];
            if (!node) return;

            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –≤—Ö–æ–¥–µ)
            if (node.effect) {
                node.effect();
                refreshUI();
            }

            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–µ–∫—Å—Ç
            document.getElementById('storyDisplay').innerText = node.text;

            // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
            const choicesDiv = document.getElementById('choicesContainer');
            choicesDiv.innerHTML = '';

            node.choices.forEach((choice, index) => {
                const btn = document.createElement('div');
                btn.className = 'choice-btn';
                btn.innerText = choice.text;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
                let reqMet = true;
                if (choice.req) {
                    if (choice.req.people !== undefined && resources.people < choice.req.people) reqMet = false;
                    if (choice.req.gold !== undefined && resources.gold < choice.req.gold) reqMet = false;
                    if (choice.req.mana !== undefined && resources.mana < choice.req.mana) reqMet = false;
                    if (choice.req.power !== undefined && resources.power < choice.req.power) reqMet = false;
                }

                if (!reqMet) {
                    btn.classList.add('disabled');
                } else {
                    btn.addEventListener('click', () => {
                        // —Å–ø–∏—Å–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ)
                        if (choice.req) {
                            if (choice.req.people) resources.people -= choice.req.people;
                            if (choice.req.gold) resources.gold -= choice.req.gold;
                            if (choice.req.mana) resources.mana -= choice.req.mana;
                            if (choice.req.power) resources.power -= choice.req.power;
                            refreshUI();
                        }
                        // —É–≤–µ–ª–∏—á–∏—Ç—å –¥–µ–Ω—å
                        day++;
                        refreshUI();

                        // –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–µ–¥ —É–∑–µ–ª
                        if (choice.nextNode) {
                            loadNode(choice.nextNode);
                        } else {
                            loadNode('start');
                        }
                    });
                }
                choicesDiv.appendChild(btn);
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω—Ü–æ–≤–∫–∏
            if (endingReached) {
                document.getElementById('storyDisplay').innerText = 'üëë –¢—ã —Å–æ–∑–¥–∞–ª –≤–µ–ª–∏–∫–æ–µ –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–æ! –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É.';
            }
        }

        // ---------- –ê–£–î–ò–û ----------
        let audioCtx = null;
        let musicGain = null;
        let soundGain = null;
        let isMusicPlaying = false;
        let ambientOsc = null;

        function initAudio() {
            if (audioCtx) return;
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                musicGain = audioCtx.createGain();
                soundGain = audioCtx.createGain();
                musicGain.connect(audioCtx.destination);
                soundGain.connect(audioCtx.destination);
                musicGain.gain.value = parseFloat(document.getElementById('musicVol').value);
                soundGain.gain.value = parseFloat(document.getElementById('soundVol').value);
            } catch (e) {}
        }

        function startAmbient() {
            if (!audioCtx) initAudio();
            if (!audioCtx || isMusicPlaying) return;
            if (ambientOsc) ambientOsc.stop();
            ambientOsc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            ambientOsc.type = 'sine';
            ambientOsc.frequency.value = 180;
            gainNode.gain.value = 0.2;
            ambientOsc.connect(gainNode).connect(musicGain);
            ambientOsc.start();
            ambientOsc.loop = true;
            setInterval(() => {
                if (isMusicPlaying && ambientOsc) {
                    ambientOsc.frequency.value = 150 + Math.sin(Date.now() / 700) * 20;
                }
            }, 300);
            isMusicPlaying = true;
        }

        function playNote() {
            if (!audioCtx) initAudio();
            if (!audioCtx || !soundGain) return;
            const osc = audioCtx.createOscillator();
            osc.type = 'triangle';
            osc.frequency.value = 440;
            osc.connect(soundGain);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // ---------- –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π ----------
        window.addEventListener('load', () => {
            refreshUI();
            loadNode('start');
        });

        document.getElementById('playMusicBtn').addEventListener('click', () => {
            initAudio();
            startAmbient();
            document.getElementById('playMusicBtn').innerText = 'üéµ –ú—É–∑—ã–∫–∞ –ª–µ—Å–∞ –∏–≥—Ä–∞–µ—Ç';
        });

        document.getElementById('musicVol').addEventListener('input', (e) => {
            if (musicGain) musicGain.gain.value = parseFloat(e.target.value);
        });

        document.getElementById('soundVol').addEventListener('input', (e) => {
            if (soundGain) soundGain.gain.value = parseFloat(e.target.value);
        });

        // –ö–õ–ò–ö –ü–û –í–ï–¢–ö–ê–ú (–ø—Ä–æ–∫–∞—á–∫–∞ –¥–µ—Ä–µ–≤–∞)
        document.getElementById('branchNature').addEventListener('click', () => {
            if (resources.mana >= 8) {
                resources.mana -= 8;
                natureLevel++;
                playNote();
                refreshUI();
                storyDisplay('üå± –î—É—Ö –ª–µ—Å–∞ —É—Å–ª—ã—à–∞–ª —Ç–µ–±—è. –û—Ç–∫—Ä—ã–ª–∏—Å—å –Ω–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏...');
            } else { storyDisplay('‚ùÑÔ∏è –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–∞–Ω—ã –¥–ª—è —Å–≤—è–∑–∏ —Å –¥—É—Ö–æ–º.'); }
        });

        document.getElementById('branchTrade').addEventListener('click', () => {
            if (resources.gold >= 12) {
                resources.gold -= 12;
                tradeLevel++;
                playNote();
                refreshUI();
                storyDisplay('üí∞ –¢–æ—Ä–≥–æ–≤—Ü—ã –∑–∞–ø–æ–º–Ω–∏–ª–∏ —Ç–≤–æ–µ –∏–º—è. –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.');
            } else { storyDisplay('üí∏ –ú–∞–ª–æ –∑–æ–ª–æ—Ç–∞.'); }
        });

        document.getElementById('branchWar').addEventListener('click', () => {
            if (resources.people >= 5 && resources.power >= 5) {
                resources.people -= 5;
                resources.power -= 5;
                warLevel++;
                playNote();
                refreshUI();
                storyDisplay('‚öîÔ∏è –î—Ä—É–∂–∏–Ω–∞ –æ–±—É—á–µ–Ω–∞. –¢–µ–ø–µ—Ä—å —Ç—ã —Å–∏–ª–∞.');
            } else { storyDisplay('üõ°Ô∏è –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –ª—é–¥–µ–π –∏–ª–∏ —Å–∏–ª—ã.'); }
        });

        // —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∞—É–¥–∏–æ –ø–æ –ø–µ—Ä–≤–æ–º—É —Ç–∞–ø—É
        document.body.addEventListener('touchstart', initAudio, { once: true });
        document.body.addEventListener('click', initAudio, { once: true });

    })();
</script>
</body>
</html>